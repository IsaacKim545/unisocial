<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UniSocial</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700;800&family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
:root{--bg:#08080d;--s1:#101018;--s2:#181822;--s3:#20202e;--bd:#282838;--tx:#e4e4f0;--tx2:#7878a0;--ac:#7c6aef;--ac2:#9d8df8;--ok:#2dd4a0;--warn:#f5a623;--err:#f05a5a;--g1:linear-gradient(135deg,#7c6aef,#b06af0,#e06af0);--r:14px;--f:'DM Sans','Noto Sans KR',sans-serif}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:var(--f);background:var(--bg);color:var(--tx);height:100vh;overflow:hidden}

/* AUTH */
.ao{position:fixed;inset:0;background:var(--bg);display:flex;align-items:center;justify-content:center;z-index:100}
.ab{background:var(--s1);border:1px solid var(--bd);border-radius:var(--r);padding:36px;width:400px;max-width:92vw}
.ab h1{font-size:28px;font-weight:800;background:var(--g1);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:6px}
.ab .tag{color:var(--tx2);font-size:13px;margin-bottom:12px}
.ab label{display:block;font-size:12px;color:var(--tx2);margin-bottom:5px;font-weight:500}
.ab input[type=email],.ab input[type=password],.ab input[type=text]{width:100%;padding:10px 14px;background:var(--s2);border:1px solid var(--bd);border-radius:8px;color:var(--tx);font-size:14px;font-family:var(--f);outline:none;margin-bottom:14px}
.ab input:focus{border-color:var(--ac)}
.abtn{width:100%;padding:12px;border:none;border-radius:10px;background:var(--g1);color:#fff;font-size:15px;font-weight:700;cursor:pointer;font-family:var(--f);margin-top:6px}
.abtn:hover{opacity:.9}.abtn:disabled{opacity:.5;cursor:not-allowed}
.atog{text-align:center;margin-top:16px;font-size:13px;color:var(--tx2)}
.atog a{color:var(--ac2);cursor:pointer}
.aerr{color:var(--err);font-size:12px;margin-bottom:10px;min-height:16px}
.cb{display:flex;align-items:center;gap:8px;margin:10px 0 6px;cursor:pointer;font-size:13px;color:var(--tx2)}
.cb input{accent-color:var(--ac);width:16px;height:16px;cursor:pointer}
.auth-lang{display:flex;gap:4px;justify-content:center;margin-bottom:18px}
.alb{padding:5px 12px;border-radius:8px;border:1px solid var(--bd);background:transparent;color:var(--tx2);cursor:pointer;font-size:12px;font-family:var(--f);transition:all .15s}
.alb:hover{border-color:var(--ac);color:var(--tx)}
.alb.on{background:var(--ac);color:#fff;border-color:var(--ac)}
.odiv{display:flex;align-items:center;gap:12px;margin:18px 0 14px;color:var(--tx2);font-size:12px}
.odiv::before,.odiv::after{content:'';flex:1;height:1px;background:var(--bd)}
.oauth{display:flex;flex-direction:column;gap:8px;margin-bottom:6px}
.obtn{display:flex;align-items:center;justify-content:center;gap:10px;width:100%;padding:11px;border-radius:10px;border:1px solid var(--bd);background:var(--s2);color:var(--tx);cursor:pointer;font-size:14px;font-weight:500;font-family:var(--f);transition:all .15s}
.obtn:hover{border-color:var(--tx2);background:var(--s3)}
.obtn img,.obtn svg{width:18px;height:18px}
.obtn.g{background:#fff;color:#333;border-color:#ddd}.obtn.g:hover{background:#f5f5f5}
.obtn.m{background:#2f2f2f;color:#fff;border-color:#444}.obtn.m:hover{background:#3a3a3a}
.obtn.a{background:#000;color:#fff;border-color:#333}.obtn.a:hover{background:#1a1a1a}

/* VERIFY */
.vcode{display:flex;gap:8px;justify-content:center;margin:20px 0}
.vcode input{width:44px;height:52px;text-align:center;font-size:22px;font-weight:700;background:var(--s2);border:1px solid var(--bd);border-radius:10px;color:var(--tx);font-family:var(--f);outline:none}
.vcode input:focus{border-color:var(--ac)}
.vinfo{text-align:center;font-size:13px;color:var(--tx2);margin-bottom:16px}
.vresend{text-align:center;margin-top:14px}
.vresend a{color:var(--ac2);cursor:pointer;font-size:13px}

/* LAYOUT */
.app{display:flex;height:100vh;display:none}
.side{width:220px;background:var(--s1);border-right:1px solid var(--bd);display:flex;flex-direction:column;flex-shrink:0}
.side-hdr{padding:18px 16px 14px;border-bottom:1px solid var(--bd)}
.side-hdr h1{font-size:20px;font-weight:800;background:var(--g1);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.side-hdr p{font-size:10px;color:var(--tx2);letter-spacing:.8px;margin-top:3px}
.snav{flex:1;padding:10px 8px}
.sni{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:10px;cursor:pointer;color:var(--tx2);font-size:14px;font-weight:500;transition:all .15s;margin-bottom:2px}
.sni:hover{background:var(--s2);color:var(--tx)}.sni.on{background:rgba(124,106,239,.14);color:var(--ac2)}
.sni .ico{font-size:17px;width:22px;text-align:center}
.sfoot{padding:10px 8px;border-top:1px solid var(--bd)}
.sfoot .lang{display:flex;gap:3px;justify-content:center;margin-bottom:8px}
.lbtn{padding:4px 9px;border-radius:6px;border:1px solid var(--bd);background:transparent;color:var(--tx2);cursor:pointer;font-size:11px;font-family:var(--f)}
.lbtn:hover{border-color:var(--ac);color:var(--tx)}.lbtn.on{background:var(--ac);color:#fff;border-color:var(--ac)}
.lout{width:100%;padding:7px;border:1px solid var(--bd);border-radius:8px;background:transparent;color:var(--tx2);cursor:pointer;font-size:12px;font-family:var(--f)}
.lout:hover{border-color:var(--err);color:var(--err)}

/* MAIN */
.mn{flex:1;overflow-y:auto;padding:28px 32px}
.mn::-webkit-scrollbar{width:5px}.mn::-webkit-scrollbar-thumb{background:var(--bd);border-radius:3px}
.pg{display:none}.pg.on{display:block}

/* STATS */
.stats{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:26px}
.stc{background:var(--s1);border:1px solid var(--bd);border-radius:var(--r);padding:18px 20px;position:relative;overflow:hidden}
.stc::after{content:'';position:absolute;top:0;left:0;right:0;height:3px}
.stc:nth-child(1)::after{background:var(--g1)}.stc:nth-child(2)::after{background:linear-gradient(90deg,#2dd4a0,#10b981)}
.stc:nth-child(3)::after{background:linear-gradient(135deg,#06b6d4,#3b82f6,#7c6aef)}.stc:nth-child(4)::after{background:linear-gradient(90deg,#f5a623,#f05a5a)}
.stc-l{font-size:11px;color:var(--tx2);font-weight:600;text-transform:uppercase;letter-spacing:1.2px}
.stc-v{font-size:30px;font-weight:800;margin-top:4px}

/* COMPOSE */
.cmp{background:var(--s1);border:1px solid var(--bd);border-radius:var(--r);padding:22px}
.cmp h2{font-size:17px;font-weight:700;margin-bottom:14px}

/* PLATFORMS */
.psec{margin-top:18px}
.psec h3{font-size:11px;color:var(--tx2);margin-bottom:9px;font-weight:600;text-transform:uppercase;letter-spacing:1.2px}
.pgr{display:flex;flex-wrap:wrap;gap:7px}
.pc{display:flex;align-items:center;gap:5px;padding:8px 15px;border-radius:18px;border:1.5px solid var(--bd);background:transparent;color:var(--tx2);cursor:pointer;font-size:12px;font-family:var(--f);font-weight:500;transition:all .15s}
.pc:hover{border-color:var(--tx2);color:var(--tx)}.pc.on{border-color:var(--ac);background:rgba(124,106,239,.1);color:var(--ac2)}
.pc.dis{opacity:.35;cursor:not-allowed}
.pc .ptype-tag{font-size:9px;padding:1px 5px;border-radius:4px;margin-left:2px;font-weight:600}
.pc .ptype-tag.media{background:rgba(240,90,90,.12);color:#f06a6a}
.pc .ptype-tag.text{background:rgba(45,212,160,.12);color:var(--ok)}
.pc .ptype-tag.both{background:rgba(124,106,239,.12);color:var(--ac2)}
.lnote{font-size:11px;color:var(--tx2);margin-top:8px;min-height:16px}

/* PLATFORM EDITOR */
.nosel{text-align:center;padding:30px 0;color:var(--tx2);font-size:13px}
.plat-header{display:flex;align-items:center;gap:10px;margin:18px 0 16px;padding-bottom:12px;border-bottom:1px solid var(--bd)}
.plat-header .ph-ico{font-size:28px}
.plat-header .ph-name{font-size:16px;font-weight:700}
.plat-header .ph-type{font-size:10px;padding:3px 8px;border-radius:6px;font-weight:600}

/* FIELD STYLES */
.pf{margin-bottom:14px}
.pf-label{display:flex;align-items:center;gap:5px;font-size:12px;color:var(--tx2);margin-bottom:5px;font-weight:500}
.pf-label .req{color:var(--err);font-size:10px}
.pf-input{width:100%;padding:10px 14px;background:var(--s2);border:1px solid var(--bd);border-radius:8px;color:var(--tx);font-size:14px;font-family:var(--f);outline:none}
.pf-input:focus{border-color:var(--ac)}.pf-input::placeholder{color:var(--tx2)}
.pf-ta{width:100%;min-height:80px;background:var(--s2);border:1px solid var(--bd);border-radius:10px;padding:12px;color:var(--tx);font-size:13px;resize:vertical;font-family:var(--f);outline:none;line-height:1.6}
.pf-ta:focus{border-color:var(--ac)}.pf-ta::placeholder{color:var(--tx2)}
.pf-cc{font-size:11px;color:var(--tx2);text-align:right;margin-top:3px}.pf-cc.over{color:var(--err)}
.pf-fz{border:2px dashed var(--bd);border-radius:8px;padding:14px;text-align:center;cursor:pointer;color:var(--tx2);font-size:12px;transition:all .15s}
.pf-fz:hover{border-color:var(--ac);color:var(--tx)}
.pf-fz.has{border-style:solid;border-color:var(--ok);color:var(--ok)}
.pf-hint{font-size:10px;color:var(--tx2);margin-top:4px;font-style:italic}
.pf-prev{display:flex;flex-wrap:wrap;gap:6px;margin-top:6px}
.pf-prev-item{position:relative;width:64px;height:64px;border-radius:6px;overflow:hidden;border:1px solid var(--bd)}
.pf-prev-item img,.pf-prev-item video{width:100%;height:100%;object-fit:cover}
.pf-prev-item .fx{position:absolute;top:1px;right:1px;width:18px;height:18px;background:rgba(0,0,0,.7);border:none;border-radius:50%;color:#fff;cursor:pointer;font-size:10px;display:flex;align-items:center;justify-content:center}

/* ACTIONS */
.sched-opts{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px}
.sopt{display:flex;align-items:center;gap:5px;padding:7px 12px;border:1px solid var(--bd);border-radius:8px;cursor:pointer;font-size:12px;transition:all .15s;background:var(--s1)}
.sopt:hover{border-color:var(--ac)}
.sopt.on{border-color:var(--ac);background:rgba(124,106,239,.08)}
.sopt input{display:none}
.acts{display:flex;gap:8px;margin-top:18px;flex-wrap:wrap}
.btn{padding:9px 18px;border-radius:10px;border:none;cursor:pointer;font-size:13px;font-weight:600;font-family:var(--f);transition:all .15s;display:inline-flex;align-items:center;gap:5px}
.btn:hover{transform:translateY(-1px)}.btn:disabled{opacity:.5;cursor:not-allowed;transform:none}
.bp{background:var(--g1);color:#fff}.bs{background:var(--s2);color:var(--tx2);border:1px solid var(--bd)}

/* HISTORY */
.hl{display:flex;flex-direction:column;gap:10px}
.hi{background:var(--s1);border:1px solid var(--bd);border-radius:var(--r);padding:16px;display:flex;gap:14px;align-items:flex-start}
.hc{flex:1}.htx{font-size:13px;line-height:1.5;margin-bottom:8px}
.hpl{display:flex;gap:4px;flex-wrap:wrap}
.hpt{font-size:10px;padding:3px 7px;border-radius:10px;background:var(--s2);color:var(--tx2)}
.hm{display:flex;flex-direction:column;align-items:flex-end;gap:5px;min-width:90px}
.hdel,.hedit{background:none;border:1px solid var(--bd);border-radius:6px;padding:4px 8px;cursor:pointer;font-size:12px;color:var(--tx2);transition:all .15s}
.hdel:hover{border-color:var(--err);color:var(--err);background:rgba(240,90,90,.08)}.hedit:hover{border-color:var(--ac);color:var(--ac);background:rgba(124,106,239,.08)}
.hs{font-size:10px;padding:3px 9px;border-radius:10px;font-weight:600;text-transform:uppercase}
.sp{background:rgba(45,212,160,.14);color:var(--ok)}.sf{background:rgba(240,90,90,.14);color:var(--err)}
.ss{background:rgba(124,106,239,.14);color:var(--ac2)}
.hd{font-size:10px;color:var(--tx2)}

/* ACCOUNTS */
.ag{display:grid;grid-template-columns:repeat(auto-fill,minmax(175px,1fr));gap:10px}
.ac{background:var(--s1);border:1px solid var(--bd);border-radius:var(--r);padding:16px;text-align:center;position:relative;overflow:hidden}
.ac .bar{position:absolute;top:0;left:0;right:0;height:3px}
.aico{font-size:26px;margin-bottom:6px}.anm{font-size:12px;font-weight:600}
.aus{font-size:11px;color:var(--tx2)}.ast{margin-top:6px;font-size:10px;color:var(--ok)}

.toast{position:fixed;bottom:20px;right:20px;padding:12px 18px;border-radius:10px;font-size:13px;font-weight:500;z-index:999;box-shadow:0 6px 24px rgba(0,0,0,.35);font-family:var(--f);transform:translateY(80px);opacity:0;transition:all .3s}
.toast.show{transform:translateY(0);opacity:1}.tok{background:var(--ok);color:#fff}.ter{background:var(--err);color:#fff}
.spinner{display:inline-block;width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:sp .6s linear infinite}
@keyframes sp{to{transform:rotate(360deg)}}
.empty{text-align:center;padding:40px;color:var(--tx2);font-size:14px}
@media(max-width:768px){.side{width:56px}.side-hdr p,.sni span:not(.ico),.sfoot .lang{display:none}.stats{grid-template-columns:repeat(2,1fr)}.mn{padding:16px 12px}}
</style>
</head>
<body>

<!-- AUTH SCREEN -->
<div class="ao" id="authScr">
<div class="ab">
  <h1>âš¡ UniSocial</h1>
  <p class="tag" id="authTag">13 Platforms, One Dashboard</p>
  <div class="auth-lang" id="authLang"></div>
  <div class="aerr" id="aerr"></div>

  <!-- LOGIN -->
  <div id="fLogin">
    <div class="oauth" id="oauthBtns"></div>
    <div class="odiv" id="odiv"><span id="odivText">ë˜ëŠ”</span></div>
    <label id="lbEmail">Email</label>
    <input type="email" id="lEmail" placeholder="test@test.com">
    <label id="lbPass">Password</label>
    <input type="password" id="lPass" placeholder="â€¢â€¢â€¢â€¢">
    <label class="cb"><input type="checkbox" id="rememberMe"> <span id="lbRemember">ë¡œê·¸ì¸ ìœ ì§€</span></label>
    <button class="abtn" id="loginBtn" onclick="doLogin()">ë¡œê·¸ì¸</button>
    <div class="atog"><a onclick="showForm('forgot')" id="lbForgot">ë¹„ë°€ë²ˆí˜¸ë¥¼ ìŠìœ¼ì…¨ë‚˜ìš”?</a></div>
    <div class="atog"><a onclick="showForm('signup')" id="lbToSignup">íšŒì›ê°€ì…</a></div>
  </div>

  <!-- SIGNUP -->
  <div id="fSignup" style="display:none">
    <label id="lbSEmail">Email</label>
    <input type="email" id="sEmail">
    <label id="lbSUser">Username</label>
    <input type="text" id="sUser">
    <label id="lbSPass">Password</label>
    <input type="password" id="sPass">
    <button class="abtn" id="signupBtn" onclick="doSignup()">íšŒì›ê°€ì…</button>
    <div class="atog"><a onclick="showForm('login')" id="lbToLogin">ë¡œê·¸ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a></div>
  </div>

  <!-- VERIFY -->
  <div id="fVerify" style="display:none">
    <div class="vinfo" id="vinfo">ì´ë©”ì¼ë¡œ ë°œì†¡ëœ 6ìë¦¬ ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.</div>
    <div class="vcode" id="vcodeBox"></div>
    <button class="abtn" id="verifyBtn" onclick="doVerify()">ì¸ì¦ í™•ì¸</button>
    <div class="vresend"><a onclick="doResend()" id="lbResend">ì½”ë“œ ì¬ë°œì†¡</a></div>
    <div class="atog" style="margin-top:10px"><a onclick="showForm('signup')" id="lbVerifyBack">ë’¤ë¡œ</a></div>
  </div>

  <!-- FORGOT PASSWORD -->
  <div id="fForgot" style="display:none">
    <div class="vinfo" id="forgotInfo">ê°€ì…í•œ ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”.</div>
    <label id="lbFEmail">Email</label>
    <input type="email" id="fgEmail">
    <button class="abtn" id="forgotBtn" onclick="doForgotSend()">ì¸ì¦ ì½”ë“œ ë°œì†¡</button>
    <div class="atog"><a onclick="showForm('login')" id="lbForgotBack">ë¡œê·¸ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a></div>
  </div>

  <!-- RESET PASSWORD -->
  <div id="fReset" style="display:none">
    <div class="vinfo" id="resetInfo">ì´ë©”ì¼ë¡œ ë°œì†¡ëœ 6ìë¦¬ ì½”ë“œì™€ ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</div>
    <label id="lbRCode">ì¸ì¦ ì½”ë“œ</label>
    <input type="text" id="rsCode" maxlength="6" placeholder="123456">
    <label id="lbRPass">ìƒˆ ë¹„ë°€ë²ˆí˜¸</label>
    <input type="password" id="rsPass" placeholder="â€¢â€¢â€¢â€¢">
    <button class="abtn" id="resetBtn" onclick="doResetPw()">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
    <div class="atog"><a onclick="showForm('forgot')" id="lbResetBack">ë’¤ë¡œ</a></div>
  </div>
</div>
</div>

<!-- APP -->
<div class="app" id="app">
  <div class="side">
    <div class="side-hdr"><h1>âš¡ UniSocial</h1><p id="stag"></p></div>
    <nav class="snav" id="snav"></nav>
    <div class="sfoot">
      <div class="lang" id="lbtns"></div>
      <button class="lout" id="loutBtn" onclick="doLogout()">ë¡œê·¸ì•„ì›ƒ</button>
    </div>
  </div>
  <div class="mn">
    <div class="pg" id="pDash">
      <div class="stats" id="stGrid"></div>
      <h2 style="font-size:16px;font-weight:700;margin-bottom:14px" id="rtitle"></h2>
      <div class="hl" id="rPosts"></div>
    </div>
    <div class="pg" id="pComp">
      <div class="cmp">
        <h2 id="ctitle">âœï¸ ìƒˆ ê²Œì‹œë¬¼</h2>
        <!-- Platform Selection (single) -->
        <div class="psec" style="margin-top:0">
          <h3 id="plab"></h3>
          <div class="pgr" id="pgrid"></div>
        </div>
        <!-- Platform Editor -->
        <div id="platEditor">
          <div class="nosel" id="noSelMsg"></div>
          <div id="platFields"></div>
        </div>
        <!-- Language + Publish -->
        <div class="psec" id="secLang" style="display:none">
          <h3 id="llabel"></h3>
          <div class="pgr" id="lgrid"></div>
          <p class="lnote" id="lnote"></p>
        </div>
        <div class="psec" id="secSched" style="display:none">
          <h3 id="schedLabel"></h3>
          <div class="sched-opts">
            <label class="sopt on" id="soptNow"><input type="radio" name="schedMode" value="now" checked onchange="toggleSched()"><span id="soptNowL">ğŸš€ ì§€ê¸ˆ ê²Œì‹œ</span></label>
            <label class="sopt" id="soptDate"><input type="radio" name="schedMode" value="date" onchange="toggleSched()"><span id="soptDateL">ğŸ“… ë‚ ì§œ/ì‹œê°„ ì§€ì •</span></label>
            <label class="sopt" id="soptDelay"><input type="radio" name="schedMode" value="delay" onchange="toggleSched()"><span id="soptDelayL">â° Nì‹œê°„ í›„</span></label>
          </div>
          <div id="schedDateWrap" style="display:none;margin-top:10px">
            <input type="datetime-local" id="schedDateTime" class="pf-input" style="width:100%">
          </div>
          <div id="schedDelayWrap" style="display:none;margin-top:10px;align-items:center;gap:8px">
            <input type="number" id="schedDelayH" class="pf-input" min="1" max="720" value="1" style="width:80px">
            <span id="schedDelayUnit" style="font-size:13px;color:var(--tx2)">ì‹œê°„ í›„</span>
          </div>
        </div>
        <div class="acts" id="secPub" style="display:none">
          <button class="btn bp" id="pubBtn" onclick="doPublish()">ğŸš€ ê²Œì‹œí•˜ê¸°</button>
        </div>
        <div id="transStatus" style="margin-top:14px;font-size:13px;display:none"></div>
      </div>
    </div>
    <div class="pg" id="pHist">
      <h2 style="font-size:20px;font-weight:700;margin-bottom:18px" id="htitle"></h2>
      <div class="hl" id="hList"></div>
    </div>
    <div class="pg" id="pAcct">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:18px">
        <h2 style="font-size:20px;font-weight:700" id="atitle"></h2>
        <button class="btn bs" onclick="doSync()">ğŸ”„ <span id="slab"></span></button>
      </div>
      <div class="ag" id="agrid"></div>
      <p class="empty" id="noAcc" style="display:none"></p>
    </div>
  </div>
</div>
<div class="toast" id="toast"></div>

<script>
const API="http://localhost:3001/api";
let token="",user=null,lang="ko",curPage="dashboard",accounts=[],selPlat="",selLangs=["ko"],pendingUser=null,curPlatData={_files:{}},editingPostId=null;

const PL=[
  // type: "media" = ë¯¸ë””ì–´ í•„ìˆ˜, "text" = í…ìŠ¤íŠ¸ ì¤‘ì‹¬, "both" = ë‘˜ ë‹¤ ê°€ëŠ¥
  {id:"instagram",i:"ğŸ“¸",n:"Instagram",c:"#E4405F",m:2200,type:"media"},
  {id:"tiktok",i:"ğŸµ",n:"TikTok",c:"#010101",m:2200,type:"media"},
  {id:"youtube",i:"â–¶ï¸",n:"YouTube",c:"#FF0000",m:5000,type:"media"},
  {id:"pinterest",i:"ğŸ“Œ",n:"Pinterest",c:"#E60023",m:500,type:"media"},
  {id:"snapchat",i:"ğŸ‘»",n:"Snapchat",c:"#FFFC00",m:250,type:"media"},
  {id:"twitter",i:"ğ•",n:"X",c:"#1DA1F2",m:280,type:"text"},
  {id:"threads",i:"ğŸ§µ",n:"Threads",c:"#000",m:500,type:"text"},
  {id:"bluesky",i:"ğŸ¦‹",n:"Bluesky",c:"#0085FF",m:300,type:"text"},
  {id:"facebook",i:"ğŸ“˜",n:"Facebook",c:"#1877F2",m:63206,type:"both"},
  {id:"linkedin",i:"ğŸ’¼",n:"LinkedIn",c:"#0A66C2",m:3000,type:"both"},
  {id:"reddit",i:"ğŸ¤–",n:"Reddit",c:"#FF4500",m:40000,type:"both"},
  {id:"telegram",i:"âœˆï¸",n:"Telegram",c:"#26A5E4",m:4096,type:"both"},
  {id:"googlebusiness",i:"ğŸ¢",n:"Google Biz",c:"#4285F4",m:1500,type:"both"},
];

const L={
  ko:{tag:"13ê°œ í”Œë«í¼, í•˜ë‚˜ì˜ í™”ë©´",dash:"ëŒ€ì‹œë³´ë“œ",comp:"ìƒˆ ê²Œì‹œë¬¼",hist:"ê²Œì‹œ ê¸°ë¡",acct:"ê³„ì • ê´€ë¦¬",
    tot:"ì´ ê²Œì‹œë¬¼",sch:"ì˜ˆì•½ë¨",conn:"ì—°ê²°ë¨",mon:"ì´ë²ˆ ë‹¬",write:"ë‚´ìš©ì„ ì‘ì„±í•˜ì„¸ìš”...",pub:"ê²Œì‹œí•˜ê¸°",
    selp:"í”Œë«í¼ ì„ íƒ",rec:"ìµœê·¼ ê²Œì‹œë¬¼",noAcc:"ì—°ê²°ëœ ê³„ì •ì´ ì—†ìŠµë‹ˆë‹¤.",sync:"ë™ê¸°í™”",out:"ë¡œê·¸ì•„ì›ƒ",
    login:"ë¡œê·¸ì¸",signup:"íšŒì›ê°€ì…",back:"ë¡œê·¸ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°",pubd:"ê²Œì‹œë¨",fail:"ì‹¤íŒ¨",pubing:"ê²Œì‹œ ì¤‘...",
    nop:"ê²Œì‹œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.",selAt:"í”Œë«í¼ì„ ì„ íƒí•˜ì„¸ìš”.",enterC:"ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.",del:"ì‚­ì œ",delConfirm:"ì´ ê²Œì‹œë¬¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?",deleted:"ì‚­ì œë¨",
    syncd:"ë™ê¸°í™” ì™„ë£Œ!",remember:"ë¡œê·¸ì¸ ìœ ì§€",
    vinfo:"ì´ë©”ì¼ë¡œ ë°œì†¡ëœ 6ìë¦¬ ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.",verify:"ì¸ì¦ í™•ì¸",resend:"ì½”ë“œ ì¬ë°œì†¡",
    file:"ğŸ“ íŒŒì¼ ì²¨ë¶€ (ì´ë¯¸ì§€/ì˜ìƒ) â€” í´ë¦­ ë˜ëŠ” ë“œë˜ê·¸",uploading:"ì—…ë¡œë“œ ì¤‘...",
    email:"ì´ë©”ì¼",password:"ë¹„ë°€ë²ˆí˜¸",username:"ì‚¬ìš©ì ì´ë¦„",verifyBack:"ë’¤ë¡œ",fillAll:"ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•˜ì„¸ìš”.",code6:"6ìë¦¬ ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.",codeSent:"ì½”ë“œ ì¬ë°œì†¡ ì™„ë£Œ!",
    forgot:"ë¹„ë°€ë²ˆí˜¸ë¥¼ ìŠìœ¼ì…¨ë‚˜ìš”?",forgotInfo:"ê°€ì…í•œ ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”. ì¸ì¦ ì½”ë“œë¥¼ ë°œì†¡í•©ë‹ˆë‹¤.",sendCode:"ì¸ì¦ ì½”ë“œ ë°œì†¡",resetInfo:"ì´ë©”ì¼ë¡œ ë°œì†¡ëœ 6ìë¦¬ ì½”ë“œì™€ ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.",resetCode:"ì¸ì¦ ì½”ë“œ",newPw:"ìƒˆ ë¹„ë°€ë²ˆí˜¸",changePw:"ë¹„ë°€ë²ˆí˜¸ ë³€ê²½",resetSent:"ì¸ì¦ ì½”ë“œê°€ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.",
    distLang:"ë°°í¬ ì–¸ì–´",distNote1:"ì›ë¬¸ ê·¸ëŒ€ë¡œ ê²Œì‹œë©ë‹ˆë‹¤.",distNoteN:"DeepLì´ ìë™ ë²ˆì—­í•˜ì—¬ {n}ê°œ ì–¸ì–´ë¡œ ê°ê° ê²Œì‹œí•©ë‹ˆë‹¤.",translating:"ë²ˆì—­ ì¤‘...",transOk:"ë²ˆì—­ ì™„ë£Œ! ê²Œì‹œ ì¤‘...",transFail:"ë²ˆì—­ ì‹¤íŒ¨ â€” ì›ë¬¸ìœ¼ë¡œ ê²Œì‹œí•©ë‹ˆë‹¤.",noApiKey:"DeepL ë²ˆì—­ì„ ì‚¬ìš©í•˜ë ¤ë©´ DEEPL_API_KEYê°€ í•„ìš”í•©ë‹ˆë‹¤. ì›ë¬¸ìœ¼ë¡œ ê²Œì‹œí•©ë‹ˆë‹¤.",pubMulti:"ê²Œì‹œë¨ â€” {n}ê°œ ì–¸ì–´",
    schedTitle:"ê²Œì‹œ ì‹œê°„",schedNow:"ğŸš€ ì§€ê¸ˆ ê²Œì‹œ",schedDate:"ğŸ“… ë‚ ì§œ/ì‹œê°„ ì§€ì •",schedDelay:"â° Nì‹œê°„ í›„",schedHourUnit:"ì‹œê°„ í›„",schedOk:"ì˜ˆì•½ ì™„ë£Œ!",mediaUploading:"ğŸ“ ë¯¸ë””ì–´ ì—…ë¡œë“œ ì¤‘...",
    edit:"ìˆ˜ì •",editSave:"ìˆ˜ì • ì™„ë£Œ",editMode:"ì˜ˆì•½ ê²Œì‹œë¬¼ ìˆ˜ì • ëª¨ë“œ",editDone:"ìˆ˜ì • ì™„ë£Œ!",editOnly:"ì˜ˆì•½ëœ ê²Œì‹œë¬¼ë§Œ ìˆ˜ì • ê°€ëŠ¥í•©ë‹ˆë‹¤.",
    or:"ë˜ëŠ”",gLogin:"Googleë¡œ ê³„ì†",mLogin:"Microsoftë¡œ ê³„ì†",aLogin:"Appleë¡œ ê³„ì†"},
  en:{tag:"13 Platforms, One Dashboard",dash:"Dashboard",comp:"New Post",hist:"History",acct:"Accounts",
    tot:"Total Posts",sch:"Scheduled",conn:"Connected",mon:"This Month",write:"Write your content...",pub:"Publish",
    selp:"Select Platforms",rec:"Recent Posts",noAcc:"No connected accounts.",sync:"Sync",out:"Logout",
    login:"Login",signup:"Sign Up",back:"Back to Login",pubd:"Published",fail:"Failed",pubing:"Publishing...",
    nop:"No posts yet.",selAt:"Select a platform.",enterC:"Enter some content.",del:"Delete",delConfirm:"Delete this post?",deleted:"Deleted",
    syncd:"Synced!",remember:"Remember me",
    vinfo:"Enter the 6-digit code sent to your email.",verify:"Verify",resend:"Resend code",
    file:"ğŸ“ Attach files (image/video) â€” click or drag",uploading:"Uploading...",
    email:"Email",password:"Password",username:"Username",verifyBack:"Back",fillAll:"Please fill in all fields.",code6:"Enter the 6-digit code.",codeSent:"Code resent!",
    forgot:"Forgot password?",forgotInfo:"Enter your email. We'll send a verification code.",sendCode:"Send Code",resetInfo:"Enter the 6-digit code and your new password.",resetCode:"Verification Code",newPw:"New Password",changePw:"Change Password",resetSent:"Verification code sent.",
    distLang:"Distribution Languages",distNote1:"Will be posted as-is.",distNoteN:"DeepL will auto-translate and post in {n} languages.",translating:"Translating...",transOk:"Translated! Publishing...",transFail:"Translation failed â€” posting original.",noApiKey:"DEEPL_API_KEY required for translation. Posting original.",pubMulti:"Published â€” {n} languages",
    schedTitle:"Publish Time",schedNow:"ğŸš€ Publish Now",schedDate:"ğŸ“… Date & Time",schedDelay:"â° After N hours",schedHourUnit:"hours later",schedOk:"Scheduled!",mediaUploading:"ğŸ“ Uploading media...",
    edit:"Edit",editSave:"Save Changes",editMode:"Editing scheduled post",editDone:"Updated!",editOnly:"Only scheduled posts can be edited.",
    or:"or",gLogin:"Continue with Google",mLogin:"Continue with Microsoft",aLogin:"Continue with Apple"},
  zh:{tag:"13ä¸ªå¹³å°ï¼Œä¸€ä¸ªç•Œé¢",dash:"ä»ªè¡¨ç›˜",comp:"æ–°å¸–å­",hist:"å†å²",acct:"è´¦æˆ·",
    tot:"æ€»å¸–å­",sch:"å·²é¢„çº¦",conn:"å·²è¿æ¥",mon:"æœ¬æœˆ",write:"è¾“å…¥å†…å®¹...",pub:"å‘å¸ƒ",
    selp:"é€‰æ‹©å¹³å°",rec:"æœ€è¿‘å¸–å­",noAcc:"æ— å·²è¿æ¥è´¦æˆ·ã€‚",sync:"åŒæ­¥",out:"é€€å‡º",
    login:"ç™»å½•",signup:"æ³¨å†Œ",back:"è¿”å›ç™»å½•",pubd:"å·²å‘å¸ƒ",fail:"å¤±è´¥",pubing:"å‘å¸ƒä¸­...",
    nop:"æš‚æ— å¸–å­ã€‚",selAt:"è¯·é€‰æ‹©å¹³å°ã€‚",enterC:"è¯·è¾“å…¥å†…å®¹ã€‚",del:"åˆ é™¤",delConfirm:"åˆ é™¤æ­¤å¸–å­ï¼Ÿ",deleted:"å·²åˆ é™¤",
    syncd:"åŒæ­¥å®Œæˆï¼",remember:"ä¿æŒç™»å½•",
    vinfo:"è¯·è¾“å…¥å‘é€åˆ°é‚®ç®±çš„6ä½éªŒè¯ç ã€‚",verify:"éªŒè¯",resend:"é‡æ–°å‘é€",
    file:"ğŸ“ é™„åŠ æ–‡ä»¶ï¼ˆå›¾ç‰‡/è§†é¢‘ï¼‰â€” ç‚¹å‡»æˆ–æ‹–æ‹½",uploading:"ä¸Šä¼ ä¸­...",
    email:"é‚®ç®±",password:"å¯†ç ",username:"ç”¨æˆ·å",verifyBack:"è¿”å›",fillAll:"è¯·å¡«å†™æ‰€æœ‰é¡¹ã€‚",code6:"è¯·è¾“å…¥6ä½éªŒè¯ç ã€‚",codeSent:"éªŒè¯ç å·²é‡å‘ï¼",
    forgot:"å¿˜è®°å¯†ç ï¼Ÿ",forgotInfo:"è¯·è¾“å…¥æ³¨å†Œé‚®ç®±ï¼Œæˆ‘ä»¬å°†å‘é€éªŒè¯ç ã€‚",sendCode:"å‘é€éªŒè¯ç ",resetInfo:"è¯·è¾“å…¥6ä½éªŒè¯ç å’Œæ–°å¯†ç ã€‚",resetCode:"éªŒè¯ç ",newPw:"æ–°å¯†ç ",changePw:"æ›´æ”¹å¯†ç ",resetSent:"éªŒè¯ç å·²å‘é€ã€‚",
    distLang:"åˆ†å‘è¯­è¨€",distNote1:"å°†æŒ‰åŸæ–‡å‘å¸ƒã€‚",distNoteN:"DeepLè‡ªåŠ¨ç¿»è¯‘å¹¶ä»¥{n}ç§è¯­è¨€åˆ†åˆ«å‘å¸ƒã€‚",translating:"ç¿»è¯‘ä¸­...",transOk:"ç¿»è¯‘å®Œæˆï¼å‘å¸ƒä¸­...",transFail:"ç¿»è¯‘å¤±è´¥ â€” ä½¿ç”¨åŸæ–‡å‘å¸ƒã€‚",noApiKey:"éœ€è¦DEEPL_API_KEYã€‚ä½¿ç”¨åŸæ–‡å‘å¸ƒã€‚",pubMulti:"å·²å‘å¸ƒ â€” {n}ç§è¯­è¨€",
    schedTitle:"å‘å¸ƒæ—¶é—´",schedNow:"ğŸš€ ç«‹å³å‘å¸ƒ",schedDate:"ğŸ“… æŒ‡å®šæ—¥æœŸæ—¶é—´",schedDelay:"â° Nå°æ—¶å",schedHourUnit:"å°æ—¶å",schedOk:"é¢„çº¦å®Œæˆï¼",mediaUploading:"ğŸ“ ä¸Šä¼ åª’ä½“ä¸­...",
    edit:"ç¼–è¾‘",editSave:"ä¿å­˜ä¿®æ”¹",editMode:"ç¼–è¾‘é¢„çº¦å¸–å­",editDone:"ä¿®æ”¹å®Œæˆï¼",editOnly:"åªèƒ½ç¼–è¾‘é¢„çº¦ä¸­çš„å¸–å­ã€‚",
    or:"æˆ–",gLogin:"ä½¿ç”¨Googleç»§ç»­",mLogin:"ä½¿ç”¨Microsoftç»§ç»­",aLogin:"ä½¿ç”¨Appleç»§ç»­"},
  ja:{tag:"13ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã€ãƒ¯ãƒ³ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰",dash:"ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰",comp:"æ–°è¦æŠ•ç¨¿",hist:"å±¥æ­´",acct:"ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ",
    tot:"ç·æŠ•ç¨¿",sch:"äºˆç´„æ¸ˆ",conn:"æ¥ç¶šæ¸ˆ",mon:"ä»Šæœˆ",write:"å†…å®¹ã‚’å…¥åŠ›...",pub:"æŠ•ç¨¿ã™ã‚‹",
    selp:"ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ é¸æŠ",rec:"æœ€è¿‘ã®æŠ•ç¨¿",noAcc:"æ¥ç¶šã‚¢ã‚«ã‚¦ãƒ³ãƒˆãªã—ã€‚",sync:"åŒæœŸ",out:"ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ",
    login:"ãƒ­ã‚°ã‚¤ãƒ³",signup:"ä¼šå“¡ç™»éŒ²",back:"ãƒ­ã‚°ã‚¤ãƒ³ã«æˆ»ã‚‹",pubd:"æŠ•ç¨¿æ¸ˆ",fail:"å¤±æ•—",pubing:"æŠ•ç¨¿ä¸­...",
    nop:"æŠ•ç¨¿ãªã—ã€‚",selAt:"ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚’é¸æŠã€‚",enterC:"å†…å®¹ã‚’å…¥åŠ›ã€‚",del:"å‰Šé™¤",delConfirm:"ã“ã®æŠ•ç¨¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ",deleted:"å‰Šé™¤æ¸ˆã¿",
    syncd:"åŒæœŸå®Œäº†ï¼",remember:"ãƒ­ã‚°ã‚¤ãƒ³ç¶­æŒ",
    vinfo:"ãƒ¡ãƒ¼ãƒ«ã«é€ä¿¡ã•ã‚ŒãŸ6æ¡ã®ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã€‚",verify:"èªè¨¼",resend:"å†é€ä¿¡",
    file:"ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«æ·»ä»˜ï¼ˆç”»åƒ/å‹•ç”»ï¼‰â€” ã‚¯ãƒªãƒƒã‚¯ã¾ãŸã¯ãƒ‰ãƒ©ãƒƒã‚°",uploading:"ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­...",
    email:"ãƒ¡ãƒ¼ãƒ«",password:"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰",username:"ãƒ¦ãƒ¼ã‚¶ãƒ¼å",verifyBack:"æˆ»ã‚‹",fillAll:"å…¨é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚",code6:"6æ¡ã®ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã€‚",codeSent:"ã‚³ãƒ¼ãƒ‰å†é€å®Œäº†ï¼",
    forgot:"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ãŠå¿˜ã‚Œã§ã™ã‹ï¼Ÿ",forgotInfo:"ç™»éŒ²ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚èªè¨¼ã‚³ãƒ¼ãƒ‰ã‚’é€ä¿¡ã—ã¾ã™ã€‚",sendCode:"ã‚³ãƒ¼ãƒ‰é€ä¿¡",resetInfo:"6æ¡ã®èªè¨¼ã‚³ãƒ¼ãƒ‰ã¨æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚",resetCode:"èªè¨¼ã‚³ãƒ¼ãƒ‰",newPw:"æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰",changePw:"ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´",resetSent:"èªè¨¼ã‚³ãƒ¼ãƒ‰ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚",
    distLang:"é…ä¿¡è¨€èª",distNote1:"åŸæ–‡ã®ã¾ã¾æŠ•ç¨¿ã•ã‚Œã¾ã™ã€‚",distNoteN:"DeepLãŒè‡ªå‹•ç¿»è¨³ã—{n}è¨€èªã§æŠ•ç¨¿ã—ã¾ã™ã€‚",translating:"ç¿»è¨³ä¸­...",transOk:"ç¿»è¨³å®Œäº†ï¼æŠ•ç¨¿ä¸­...",transFail:"ç¿»è¨³å¤±æ•— â€” åŸæ–‡ã§æŠ•ç¨¿ã—ã¾ã™ã€‚",noApiKey:"DEEPL_API_KEYå¿…è¦ã€‚åŸæ–‡ã§æŠ•ç¨¿ã—ã¾ã™ã€‚",pubMulti:"æŠ•ç¨¿å®Œäº† â€” {n}è¨€èª",
    schedTitle:"æŠ•ç¨¿æ™‚é–“",schedNow:"ğŸš€ ä»Šã™ãæŠ•ç¨¿",schedDate:"ğŸ“… æ—¥æ™‚æŒ‡å®š",schedDelay:"â° Næ™‚é–“å¾Œ",schedHourUnit:"æ™‚é–“å¾Œ",schedOk:"äºˆç´„å®Œäº†ï¼",mediaUploading:"ğŸ“ ãƒ¡ãƒ‡ã‚£ã‚¢ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­...",
    edit:"ç·¨é›†",editSave:"å¤‰æ›´ã‚’ä¿å­˜",editMode:"äºˆç´„æŠ•ç¨¿ã‚’ç·¨é›†ä¸­",editDone:"æ›´æ–°å®Œäº†ï¼",editOnly:"äºˆç´„æŠ•ç¨¿ã®ã¿ç·¨é›†å¯èƒ½ã§ã™ã€‚",
    or:"ã¾ãŸã¯",gLogin:"Googleã§ç¶šã‘ã‚‹",mLogin:"Microsoftã§ç¶šã‘ã‚‹",aLogin:"Appleã§ç¶šã‘ã‚‹"},
};
function t(k){return L[lang]?.[k]||L.ko[k]||k}

// â”€â”€â”€ Storage (remember me) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getStore(){return document.getElementById("rememberMe")?.checked?localStorage:sessionStorage}
function loadSession(){
  token=localStorage.getItem("sh_t")||sessionStorage.getItem("sh_t")||"";
  user=JSON.parse(localStorage.getItem("sh_u")||sessionStorage.getItem("sh_u")||"null");
  lang=localStorage.getItem("sh_l")||sessionStorage.getItem("sh_l")||"ko";
}
function saveSession(remember){
  const s=remember?localStorage:sessionStorage;
  s.setItem("sh_t",token);s.setItem("sh_u",JSON.stringify(user));s.setItem("sh_l",lang);
}
function clearSession(){
  ["sh_t","sh_u","sh_l"].forEach(k=>{localStorage.removeItem(k);sessionStorage.removeItem(k)});
  token="";user=null;
}

// â”€â”€â”€ API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function api(path,opts={}){
  const h={"Content-Type":"application/json","X-Language":lang};
  if(token)h["Authorization"]="Bearer "+token;
  const r=await fetch(API+path,{...opts,headers:{...h,...opts.headers}});
  const d=await r.json();
  if(!r.ok)throw new Error(d.error||"Error");
  return d;
}

function toast(msg,ok=true){
  const e=document.getElementById("toast");
  e.textContent=msg;e.className="toast "+(ok?"tok":"ter")+" show";
  setTimeout(()=>e.classList.remove("show"),2500);
}

function showErr(msg){const e=document.getElementById("aerr");e.textContent=msg;setTimeout(()=>e.textContent="",4000)}

// â”€â”€â”€ AUTH FORMS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildAuthLang(){
  document.getElementById("authLang").innerHTML=
    ["ko","en","zh","ja"].map(l=>
      `<button class="alb${lang===l?" on":""}" onclick="setAuthLang('${l}')">${{ko:"í•œêµ­ì–´",en:"English",zh:"ä¸­æ–‡",ja:"æ—¥æœ¬èª"}[l]}</button>`
    ).join("");
}

function setAuthLang(l){
  lang=l;localStorage.setItem("sh_l",l);
  buildAuthLang();updAuthTexts();
}

function updAuthTexts(){
  document.getElementById("authTag").textContent=t("tag");
  document.getElementById("odivText").textContent=t("or");
  // Login
  document.getElementById("lbEmail").textContent=t("email");
  document.getElementById("lbPass").textContent=t("password");
  document.getElementById("lbRemember").textContent=t("remember");
  document.getElementById("loginBtn").textContent=t("login");
  document.getElementById("lbToSignup").textContent=t("signup");
  // Signup
  document.getElementById("lbSEmail").textContent=t("email");
  document.getElementById("lbSUser").textContent=t("username");
  document.getElementById("lbSPass").textContent=t("password");
  document.getElementById("signupBtn").textContent=t("signup");
  document.getElementById("lbToLogin").textContent=t("back");
  // Verify
  document.getElementById("vinfo").textContent=t("vinfo");
  document.getElementById("verifyBtn").textContent=t("verify");
  document.getElementById("lbResend").textContent=t("resend");
  document.getElementById("lbVerifyBack").textContent=t("verifyBack");
  // Forgot
  document.getElementById("lbForgot").textContent=t("forgot");
  document.getElementById("forgotInfo").textContent=t("forgotInfo");
  document.getElementById("lbFEmail").textContent=t("email");
  document.getElementById("forgotBtn").textContent=t("sendCode");
  document.getElementById("lbForgotBack").textContent=t("back");
  // Reset
  document.getElementById("resetInfo").textContent=t("resetInfo");
  document.getElementById("lbRCode").textContent=t("resetCode");
  document.getElementById("lbRPass").textContent=t("newPw");
  document.getElementById("resetBtn").textContent=t("changePw");
  document.getElementById("lbResetBack").textContent=t("back");
  // OAuth buttons
  buildOAuthBtns();
}

function showForm(f){
  ["fLogin","fSignup","fVerify","fForgot","fReset"].forEach(id=>{
    document.getElementById(id).style.display="none";
  });
  const map={login:"fLogin",signup:"fSignup",verify:"fVerify",forgot:"fForgot",reset:"fReset"};
  if(map[f])document.getElementById(map[f]).style.display="";
  document.getElementById("aerr").textContent="";
  if(f==="verify")buildCodeInputs();
  updAuthTexts();
}

function buildCodeInputs(){
  const box=document.getElementById("vcodeBox");
  box.innerHTML=Array(6).fill(0).map((_,i)=>`<input type="text" maxlength="1" id="vc${i}" oninput="vcNext(${i})" onkeydown="vcBack(event,${i})">`).join("");
  document.getElementById("vinfo").textContent=t("vinfo");
  setTimeout(()=>document.getElementById("vc0")?.focus(),100);
}
function vcNext(i){const v=document.getElementById("vc"+i).value;if(v&&i<5)document.getElementById("vc"+(i+1)).focus()}
function vcBack(e,i){if(e.key==="Backspace"&&!document.getElementById("vc"+i).value&&i>0)document.getElementById("vc"+(i-1)).focus()}
function getCode(){return Array(6).fill(0).map((_,i)=>document.getElementById("vc"+i).value).join("")}

// â”€â”€â”€ SIGNUP â†’ VERIFY â†’ COMPLETE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function doSignup(){
  const email=document.getElementById("sEmail").value;
  const username=document.getElementById("sUser").value;
  const password=document.getElementById("sPass").value;
  if(!email||!username||!password)return showErr(t("fillAll"));
  const btn=document.getElementById("signupBtn");
  btn.disabled=true;
  try{
    const d=await api("/auth/signup",{method:"POST",body:JSON.stringify({email,password,username,language:lang})});
    pendingUser=d.pendingUser;
    showForm("verify");
  }catch(e){showErr(e.message)}
  finally{btn.disabled=false}
}

async function doVerify(){
  const code=getCode();
  if(code.length!==6)return showErr(t("code6"));
  const btn=document.getElementById("verifyBtn");
  btn.disabled=true;
  try{
    const d=await api("/auth/verify",{method:"POST",body:JSON.stringify({...pendingUser,code})});
    token=d.token;user=d.user;
    if(user.language)lang=user.language;
    saveSession(true);
    enterApp();
  }catch(e){showErr(e.message)}
  finally{btn.disabled=false}
}

async function doResend(){
  if(!pendingUser)return;
  try{
    await api("/auth/resend-code",{method:"POST",body:JSON.stringify({email:pendingUser.email,language:lang})});
    toast(t("codeSent"));buildCodeInputs();
  }catch(e){showErr(e.message)}
}

let resetEmail="";
async function doForgotSend(){
  const email=document.getElementById("fgEmail").value.trim();
  if(!email)return showErr(t("fillAll"));
  const btn=document.getElementById("forgotBtn");
  btn.disabled=true;btn.textContent="...";
  try{
    const d=await api("/auth/forgot-password",{method:"POST",body:JSON.stringify({email,language:lang})});
    resetEmail=email;
    toast(t("resetSent"));
    showForm("reset");
    if(d.devCode)document.getElementById("rsCode").value=d.devCode;
  }catch(e){showErr(e.message)}
  finally{btn.disabled=false;btn.textContent=t("sendCode")}
}

async function doResetPw(){
  const code=document.getElementById("rsCode").value.trim();
  const newPassword=document.getElementById("rsPass").value;
  if(!code||!newPassword)return showErr(t("fillAll"));
  const btn=document.getElementById("resetBtn");
  btn.disabled=true;btn.textContent="...";
  try{
    const d=await api("/auth/reset-password",{method:"POST",body:JSON.stringify({email:resetEmail,code,newPassword})});
    toast("âœ… "+d.message);
    showForm("login");
  }catch(e){showErr(e.message)}
  finally{btn.disabled=false;btn.textContent=t("changePw")}
}

async function doLogin(){
  const email=document.getElementById("lEmail").value;
  const password=document.getElementById("lPass").value;
  const remember=document.getElementById("rememberMe").checked;
  try{
    const d=await api("/auth/login",{method:"POST",body:JSON.stringify({email,password})});
    token=d.token;user=d.user;
    if(user.language)lang=user.language;
    saveSession(remember);
    enterApp();
  }catch(e){showErr(e.message)}
}

async function doLogout(){
  try{await api("/auth/logout",{method:"POST"})}catch(e){}
  clearSession();
  document.getElementById("authScr").style.display="flex";
  document.getElementById("app").style.display="none";
}

// â”€â”€â”€ ENTER APP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function enterApp(){
  document.getElementById("authScr").style.display="none";
  document.getElementById("app").style.display="flex";
  buildSide();buildLang();buildPlats();buildLangsGrid();updTexts();
  nav("dashboard");loadAccounts();
}

// â”€â”€â”€ SIDEBAR & LANG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildSide(){
  const items=[{id:"dashboard",i:"ğŸ“Š",k:"dash"},{id:"accounts",i:"ğŸ”—",k:"acct"},{id:"compose",i:"âœï¸",k:"comp"},{id:"history",i:"ğŸ“‹",k:"hist"}];
  document.getElementById("snav").innerHTML=items.map(x=>
    `<div class="sni${curPage===x.id?" on":""}" onclick="nav('${x.id}')"><span class="ico">${x.i}</span><span>${t(x.k)}</span></div>`
  ).join("");
}
function buildLang(){
  document.getElementById("lbtns").innerHTML=["ko","en","zh","ja"].map(l=>
    `<button class="lbtn${lang===l?" on":""}" onclick="setLang('${l}')">${l.toUpperCase()}</button>`
  ).join("");
}
function setLang(l){lang=l;saveSession(!!localStorage.getItem("sh_t"));buildSide();buildLang();updTexts();buildPlats();buildLangsGrid();nav(curPage)}
function updTexts(){
  document.getElementById("stag").textContent=t("tag");
  document.getElementById("loutBtn").textContent=t("out");
  document.getElementById("ctitle").textContent="âœï¸ "+t("comp");
  document.getElementById("htitle").textContent="ğŸ“‹ "+t("hist");
  document.getElementById("atitle").textContent="ğŸ”— "+t("acct");
  document.getElementById("plab").textContent=t("selp");
  document.getElementById("llabel").textContent=t("distLang");
  document.getElementById("rtitle").textContent=t("rec");
  document.getElementById("slab").textContent=t("sync");
  document.getElementById("pubBtn").innerHTML="ğŸš€ "+t("pub");
  document.getElementById("noAcc").textContent=t("noAcc");
  // schedule
  document.getElementById("schedLabel").textContent=t("schedTitle");
  document.getElementById("soptNowL").textContent=t("schedNow");
  document.getElementById("soptDateL").textContent=t("schedDate");
  document.getElementById("soptDelayL").textContent=t("schedDelay");
  document.getElementById("schedDelayUnit").textContent=t("schedHourUnit");
  updLangNote();
}

// â”€â”€â”€ DISTRIBUTION LANGUAGE GRID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const LANGS=[
  {id:"ko",label:"ğŸ‡°ğŸ‡· í•œêµ­ì–´"},{id:"en",label:"ğŸ‡ºğŸ‡¸ English"},{id:"zh",label:"ğŸ‡¨ğŸ‡³ ä¸­æ–‡"},{id:"ja",label:"ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª"},
  {id:"es",label:"ğŸ‡ªğŸ‡¸ EspaÃ±ol"},{id:"fr",label:"ğŸ‡«ğŸ‡· FranÃ§ais"},{id:"de",label:"ğŸ‡©ğŸ‡ª Deutsch"},{id:"pt",label:"ğŸ‡§ğŸ‡· PortuguÃªs"},
  {id:"ru",label:"ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹"},{id:"ar",label:"ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"},{id:"hi",label:"ğŸ‡®ğŸ‡³ à¤¹à¤¿à¤¨à¥à¤¦à¥€"},{id:"th",label:"ğŸ‡¹ğŸ‡­ à¹„à¸—à¸¢"},
  {id:"vi",label:"ğŸ‡»ğŸ‡³ Tiáº¿ng Viá»‡t"},{id:"id",label:"ğŸ‡®ğŸ‡© Bahasa"},{id:"tr",label:"ğŸ‡¹ğŸ‡· TÃ¼rkÃ§e"},{id:"it",label:"ğŸ‡®ğŸ‡¹ Italiano"},
  {id:"nl",label:"ğŸ‡³ğŸ‡± Nederlands"},{id:"pl",label:"ğŸ‡µğŸ‡± Polski"},{id:"sv",label:"ğŸ‡¸ğŸ‡ª Svenska"},{id:"uk",label:"ğŸ‡ºğŸ‡¦ Ğ£ĞºÑ€Ğ°Ñ—Ğ½ÑÑŒĞºĞ°"},
];

function buildLangsGrid(){
  document.getElementById("lgrid").innerHTML=LANGS.map(l=>
    `<button class="pc${selLangs.includes(l.id)?" on":""}" onclick="togLang('${l.id}')">${l.label}</button>`
  ).join("");
  updLangNote();
}
function togLang(id){
  if(selLangs.includes(id)){
    if(selLangs.length<=1)return; // ìµœì†Œ 1ê°œ ìœ ì§€
    selLangs=selLangs.filter(x=>x!==id);
  }else{
    selLangs.push(id);
  }
  buildLangsGrid();
}
function updLangNote(){
  const el=document.getElementById("lnote");
  if(selLangs.length<=1) el.textContent=t("distNote1");
  else el.textContent=t("distNoteN").replace("{n}",selLangs.length);
}

// â”€â”€â”€ NAVIGATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function nav(p){
  curPage=p;
  document.querySelectorAll(".pg").forEach(e=>e.classList.remove("on"));
  const map={dashboard:"pDash",compose:"pComp",history:"pHist",accounts:"pAcct"};
  document.getElementById(map[p]).classList.add("on");
  buildSide();
  if(p==="dashboard")loadDash();
  if(p==="history")loadHist();
  if(p==="accounts")renderAccts();
}

// â”€â”€â”€ DASHBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadDash(){
  try{
    const d=await api("/posts?limit=5");
    const tot=d.total||0;
    document.getElementById("stGrid").innerHTML=[
      [t("tot"),tot],[t("sch"),0],[t("conn"),accounts.length+"/13"],[t("mon"),tot]
    ].map(([l,v])=>`<div class="stc"><div class="stc-l">${l}</div><div class="stc-v">${v}</div></div>`).join("");
    renderPosts(d.posts||[],"rPosts");
  }catch(e){
    document.getElementById("stGrid").innerHTML="";
    document.getElementById("rPosts").innerHTML=`<p class="empty">${t("nop")}</p>`;
  }
}

// â”€â”€â”€ HISTORY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadHist(){
  try{const d=await api("/posts?limit=50");renderPosts(d.posts||[],"hList")}
  catch(e){document.getElementById("hList").innerHTML=`<p class="empty">${t("nop")}</p>`}
}

function renderPosts(posts,tid){
  const el=document.getElementById(tid);
  const isHist=tid==="hList";
  if(!posts.length){el.innerHTML=`<p class="empty">${t("nop")}</p>`;return}
  el.innerHTML=posts.map(p=>{
    const pls=(typeof p.platforms==="string"?JSON.parse(p.platforms):p.platforms)||[];
    const st=p.status||"published";
    const sc=st==="published"?"sp":st==="scheduled"?"ss":"sf";
    const sn=st==="published"?t("pubd"):st==="scheduled"?t("sch"):t("fail");
    const dt=new Date(p.created_at).toLocaleDateString();
    const schedAt=p.scheduled_at?`<span class="hd" style="color:var(--ac)">ğŸ“… ${new Date(p.scheduled_at).toLocaleString()}</span>`:"";
    const del=isHist?`<button class="hdel" onclick="delPost(${p.id})" title="${t("del")}">ğŸ—‘</button>`:"";
    const edit=(isHist&&st==="scheduled")?`<button class="hedit" onclick="editPost(${p.id})" title="${t("edit")}">âœï¸</button>`:"";
    return`<div class="hi" id="post_${p.id}"><div class="hc"><div class="htx">${escH(p.content)}</div><div class="hpl">${pls.map(pid=>{const pl=PL.find(x=>x.id===pid);return`<span class="hpt">${pl?.i||""} ${pl?.n||pid}</span>`}).join("")}</div></div><div class="hm"><span class="hs ${sc}">${sn}</span>${schedAt}<span class="hd">${dt}</span>${edit}${del}</div></div>`;
  }).join("");
}
function escH(s){const d=document.createElement("div");d.textContent=s;return d.innerHTML}

async function delPost(id){
  if(!confirm(t("delConfirm")))return;
  try{
    await api("/posts/"+id,{method:"DELETE"});
    const el=document.getElementById("post_"+id);
    if(el){el.style.opacity="0";el.style.transition="all .3s";setTimeout(()=>el.remove(),300)}
    toast("âœ… "+t("deleted"));
  }catch(e){toast("âŒ "+e.message,false)}
}

async function editPost(id){
  try{
    const d=await api("/posts/"+id);
    const p=d.post;
    if(!p)return toast("âŒ Not found",false);

    const pls=(typeof p.platforms==="string"?JSON.parse(p.platforms):p.platforms)||[];
    const spec=(typeof p.platform_specific==="string"?JSON.parse(p.platform_specific):p.platform_specific)||{};
    const media=(typeof p.media_urls==="string"?JSON.parse(p.media_urls):p.media_urls)||[];
    const platId=pls[0];
    if(!platId)return;

    // í¸ì§‘ ëª¨ë“œ ì„¤ì •
    editingPostId=id;

    // í”Œë«í¼ ë° ë°ì´í„° ì„¸íŒ… (pickPlat í˜¸ì¶œí•˜ë©´ ë°ì´í„°ê°€ ë¦¬ì…‹ë˜ë¯€ë¡œ ì§ì ‘ ì„¤ì •)
    selPlat=platId;
    curPlatData={_files:{}};

    // í…ìŠ¤íŠ¸ í•„ë“œ ì±„ìš°ê¸°
    const pf=PF[platId];
    if(pf){
      const mainKey=pf.fields.find(f=>["text","caption","description"].includes(f.k)&&f.type==="textarea")?.k;
      if(mainKey)curPlatData[mainKey]=p.content||"";
      const platSpec=spec[platId]||{};
      if(platSpec.title)curPlatData.title=platSpec.title;
      if(platSpec.firstComment)curPlatData.firstComment=platSpec.firstComment;
      if(platSpec.tags)curPlatData.tags=Array.isArray(platSpec.tags)?platSpec.tags.join(", "):platSpec.tags;
      if(platSpec.subreddit)curPlatData.subreddit=platSpec.subreddit;
      if(platSpec.link)curPlatData.link=platSpec.link;
    }

    // ë¯¸ë””ì–´ ë³µì›
    if(media.length>0){
      const fileKey=pf?.fields.find(f=>f.type==="file")?.k||"media";
      curPlatData._files[fileKey]=[];
      media.forEach(m=>{
        const item=typeof m==="string"?{url:m,type:"image"}:m;
        curPlatData._files[fileKey].push(item);
      });
    }

    // í™”ë©´ ì´ë™
    nav("compose");
    buildPlats();
    showEditor();

    // ì˜ˆì•½ ì‹œê°„ ë³µì›
    if(p.scheduled_at){
      const dateRadio=document.querySelector('input[name="schedMode"][value="date"]');
      if(dateRadio){dateRadio.checked=true;toggleSched()}
      const dt=new Date(p.scheduled_at);
      const local=new Date(dt.getTime()-dt.getTimezoneOffset()*60000).toISOString().slice(0,16);
      document.getElementById("schedDateTime").value=local;
    }

    // í¸ì§‘ ëª¨ë“œ í‘œì‹œ
    document.getElementById("pubBtn").innerHTML="âœï¸ "+t("editSave");
    toast("âœï¸ "+t("editMode"));
  }catch(e){toast("âŒ "+e.message,false)}
}

// â”€â”€â”€ ACCOUNTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadAccounts(){
  try{const d=await api("/social/accounts");accounts=(d.accounts||[]).filter(a=>a.is_active);buildPlats()}
  catch(e){accounts=[]}
}
async function doSync(){
  try{const d=await api("/social/sync",{method:"POST"});accounts=(d.accounts||[]).filter(a=>a.is_active);toast(t("syncd")+" ("+d.synced+")");buildPlats();renderAccts()}
  catch(e){toast(e.message,false)}
}
function renderAccts(){
  const g=document.getElementById("agrid"),m=document.getElementById("noAcc");
  if(!accounts.length){g.innerHTML="";m.style.display="";return}
  m.style.display="none";
  g.innerHTML=accounts.map(a=>{const p=PL.find(x=>x.id===a.platform);return`<div class="ac"><div class="bar" style="background:${p?.c||"var(--ac)"}"></div><div class="aico">${p?.i||"ğŸ“±"}</div><div class="anm">${p?.n||a.platform}</div><div class="aus">${a.platform_username||""}</div><div class="ast">â— Connected</div></div>`}).join("");
}

// â”€â”€â”€ PLATFORM FIELDS DEFINITION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const PF={
  youtube:{fields:[
    {k:"video",type:"file",accept:"video/*",req:true},
    {k:"thumbnail",type:"file",accept:"image/*"},
    {k:"title",type:"input",max:100,req:true},
    {k:"description",type:"textarea",max:5000},
    {k:"tags",type:"input",hint:true},
    {k:"firstComment",type:"textarea",max:500}
  ]},
  instagram:{fields:[
    {k:"media",type:"file",accept:"image/*,video/*",multi:true,req:true},
    {k:"caption",type:"textarea",max:2200},
    {k:"firstComment",type:"textarea",max:300}
  ]},
  tiktok:{fields:[
    {k:"video",type:"file",accept:"video/*",req:true},
    {k:"caption",type:"textarea",max:2200}
  ]},
  pinterest:{fields:[
    {k:"image",type:"file",accept:"image/*",req:true},
    {k:"title",type:"input",max:100,req:true},
    {k:"description",type:"textarea",max:500},
    {k:"link",type:"input"}
  ]},
  snapchat:{fields:[
    {k:"media",type:"file",accept:"image/*,video/*",req:true},
    {k:"caption",type:"textarea",max:250}
  ]},
  twitter:{fields:[
    {k:"text",type:"textarea",max:280,req:true},
    {k:"media",type:"file",accept:"image/*,video/*",multi:true}
  ]},
  threads:{fields:[
    {k:"text",type:"textarea",max:500,req:true},
    {k:"media",type:"file",accept:"image/*,video/*",multi:true}
  ]},
  bluesky:{fields:[
    {k:"text",type:"textarea",max:300,req:true},
    {k:"media",type:"file",accept:"image/*",multi:true}
  ]},
  facebook:{fields:[
    {k:"text",type:"textarea",max:63206,req:true},
    {k:"media",type:"file",accept:"image/*,video/*",multi:true},
    {k:"link",type:"input"}
  ]},
  linkedin:{fields:[
    {k:"text",type:"textarea",max:3000,req:true},
    {k:"media",type:"file",accept:"image/*,video/*",multi:true}
  ]},
  reddit:{fields:[
    {k:"subreddit",type:"input",req:true},
    {k:"title",type:"input",max:300,req:true},
    {k:"text",type:"textarea",max:40000},
    {k:"media",type:"file",accept:"image/*,video/*",multi:true}
  ]},
  telegram:{fields:[
    {k:"text",type:"textarea",max:4096,req:true},
    {k:"media",type:"file",accept:"image/*,video/*",multi:true}
  ]},
  googlebusiness:{fields:[
    {k:"text",type:"textarea",max:1500,req:true},
    {k:"media",type:"file",accept:"image/*",multi:true}
  ]}
};

const FL={
  ko:{title:"ì œëª©",description:"ì„¤ëª…",text:"ë³¸ë¬¸",caption:"ìº¡ì…˜",video:"ì˜ìƒ íŒŒì¼",media:"ì‚¬ì§„/ì˜ìƒ",
    image:"ì´ë¯¸ì§€",thumbnail:"ì¸ë„¤ì¼ ì´ë¯¸ì§€",tags:"íƒœê·¸",firstComment:"ì²« ë²ˆì§¸ ëŒ“ê¸€",link:"ë§í¬ URL",
    subreddit:"ì„œë¸Œë ˆë”§ (r/)",reqMark:"í•„ìˆ˜",tagsHint:"ì‰¼í‘œë¡œ êµ¬ë¶„ (ì˜ˆ: ì—¬í–‰, ì¼ìƒ, vlog)",
    selPlat:"â¬†ï¸ í”Œë«í¼ì„ ì„ íƒí•˜ì„¸ìš”",clickUpload:"í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ",uploaded:"ê°œ ì—…ë¡œë“œë¨",
    mediaT:"ë¯¸ë””ì–´",textT:"í…ìŠ¤íŠ¸",bothT:"ë³µí•©"},
  en:{title:"Title",description:"Description",text:"Text",caption:"Caption",video:"Video file",
    media:"Photo/Video",image:"Image",thumbnail:"Thumbnail image",tags:"Tags",firstComment:"First comment",
    link:"Link URL",subreddit:"Subreddit (r/)",reqMark:"required",tagsHint:"Comma separated (e.g. travel, daily, vlog)",
    selPlat:"â¬†ï¸ Select a platform above",clickUpload:"Click to upload",uploaded:"uploaded",
    mediaT:"Media",textT:"Text",bothT:"Mixed"},
  zh:{title:"æ ‡é¢˜",description:"æè¿°",text:"æ­£æ–‡",caption:"è¯´æ˜æ–‡å­—",video:"è§†é¢‘æ–‡ä»¶",
    media:"ç…§ç‰‡/è§†é¢‘",image:"å›¾ç‰‡",thumbnail:"ç¼©ç•¥å›¾",tags:"æ ‡ç­¾",firstComment:"ç¬¬ä¸€æ¡è¯„è®º",
    link:"é“¾æ¥URL",subreddit:"å­ç‰ˆå— (r/)",reqMark:"å¿…å¡«",tagsHint:"é€—å·åˆ†éš”",
    selPlat:"â¬†ï¸ è¯·åœ¨ä¸Šæ–¹é€‰æ‹©å¹³å°",clickUpload:"ç‚¹å‡»ä¸Šä¼ ",uploaded:"å·²ä¸Šä¼ ",
    mediaT:"åª’ä½“",textT:"æ–‡æœ¬",bothT:"æ··åˆ"},
  ja:{title:"ã‚¿ã‚¤ãƒˆãƒ«",description:"èª¬æ˜",text:"æœ¬æ–‡",caption:"ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³",video:"å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«",
    media:"å†™çœŸ/å‹•ç”»",image:"ç”»åƒ",thumbnail:"ã‚µãƒ ãƒã‚¤ãƒ«ç”»åƒ",tags:"ã‚¿ã‚°",firstComment:"æœ€åˆã®ã‚³ãƒ¡ãƒ³ãƒˆ",
    link:"ãƒªãƒ³ã‚¯URL",subreddit:"ã‚µãƒ–ãƒ¬ãƒ‡ã‚£ãƒƒãƒˆ (r/)",reqMark:"å¿…é ˆ",tagsHint:"ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Š",
    selPlat:"â¬†ï¸ ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚’é¸æŠ",clickUpload:"ã‚¯ãƒªãƒƒã‚¯ã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰",uploaded:"ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿",
    mediaT:"ãƒ¡ãƒ‡ã‚£ã‚¢",textT:"ãƒ†ã‚­ã‚¹ãƒˆ",bothT:"è¤‡åˆ"},
};
function fl(k){return FL[lang]?.[k]||FL.ko[k]||k}
function esc(s){return(s||"").replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;")}

// â”€â”€â”€ PLATFORM GRID (single select) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildPlats(){
  const ci=accounts.map(a=>a.platform);
  const typeTag={media:"mediaT",text:"textT",both:"bothT"};
  document.getElementById("pgrid").innerHTML=PL.map(p=>{
    const con=ci.includes(p.id),sel=selPlat===p.id;
    const tag=`<span class="ptype-tag ${p.type}">${fl(typeTag[p.type])}</span>`;
    return`<button class="pc${sel?" on":""}${con?"":" dis"}" onclick="${con?`pickPlat('${p.id}')`:""}">${p.i} ${p.n} ${tag}</button>`;
  }).join("");
  showEditor();
}

function pickPlat(id){
  if(selPlat===id){selPlat="";curPlatData={_files:{}}}
  else{
    // ê¸°ì¡´ ë°ì´í„° ì €ì¥ í›„ ì „í™˜
    saveFields();
    selPlat=id;
    curPlatData={_files:{}};
  }
  buildPlats();
}

// â”€â”€â”€ EDITOR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showEditor(){
  const nosel=document.getElementById("noSelMsg");
  const fields=document.getElementById("platFields");
  const secLang=document.getElementById("secLang");
  const secPub=document.getElementById("secPub");

  if(!selPlat){
    nosel.style.display="";nosel.textContent=fl("selPlat");
    fields.innerHTML="";
    secLang.style.display="none";secPub.style.display="none";
    document.getElementById("secSched").style.display="none";
    return;
  }
  nosel.style.display="none";
  secLang.style.display="";secPub.style.display="";
  document.getElementById("secSched").style.display="";

  const p=PL.find(x=>x.id===selPlat);
  const typeColors={media:"rgba(240,90,90,.12);color:#f06a6a",text:"rgba(45,212,160,.12);color:var(--ok)",both:"rgba(124,106,239,.12);color:var(--ac2)"};
  const typeTag={media:"mediaT",text:"textT",both:"bothT"};

  let h=`<div class="plat-header">
    <span class="ph-ico">${p.i}</span>
    <span class="ph-name">${p.n}</span>
    <span class="ph-type" style="background:${typeColors[p.type]}">${fl(typeTag[p.type])}</span>
  </div>`;

  const pf=PF[selPlat];
  if(!pf){fields.innerHTML=h;return}
  const d=curPlatData;

  pf.fields.forEach(f=>{
    const lab=fl(f.k);
    const rq=f.req?` <span class="req">*${fl("reqMark")}</span>`:"";

    if(f.type==="input"){
      h+=`<div class="pf"><div class="pf-label">${lab}${rq}</div>
        <input class="pf-input" id="pf_${f.k}" value="${esc(d[f.k])}" maxlength="${f.max||500}" placeholder="${lab}">
        ${f.hint?`<div class="pf-hint">${fl("tagsHint")}</div>`:""}</div>`;
    }else if(f.type==="textarea"){
      const v=d[f.k]||"",mx=f.max||5000;
      h+=`<div class="pf"><div class="pf-label">${lab}${rq}</div>
        <textarea class="pf-ta" id="pf_${f.k}" maxlength="${mx}" placeholder="${lab}" oninput="updFC('${f.k}',${mx})">${esc(v)}</textarea>
        <div class="pf-cc" id="pf_cc_${f.k}">${v.length} / ${mx}</div></div>`;
    }else if(f.type==="file"){
      const files=d._files[f.k]||[];
      const has=files.length>0;
      h+=`<div class="pf"><div class="pf-label">${lab}${rq}</div>
        <input type="file" id="pf_fi_${f.k}" ${f.accept?`accept="${f.accept}"`:""} ${f.multi?"multiple":""} style="display:none" onchange="upFile('${f.k}',this.files)">
        <div class="pf-fz${has?" has":""}" onclick="document.getElementById('pf_fi_${f.k}').click()">
          ${has?`âœ… ${files.length} ${fl("uploaded")}`:`ğŸ“ ${fl("clickUpload")} â€” ${lab}`}
        </div>
        <div class="pf-prev" id="pf_fp_${f.k}">
          ${files.map((file,i)=>{
            const tag=file.type==="video"?`<video src="${file.url}" muted></video>`:`<img src="${file.url}">`;
            return`<div class="pf-prev-item">${tag}<button class="fx" onclick="rmFile('${f.k}',${i})">Ã—</button></div>`;
          }).join("")}
        </div></div>`;
    }
  });

  fields.innerHTML=h;
}

function updFC(k,mx){
  const el=document.getElementById(`pf_${k}`);
  const cc=document.getElementById(`pf_cc_${k}`);
  if(el&&cc){cc.textContent=`${el.value.length} / ${mx}`;cc.className=el.value.length>mx?"pf-cc over":"pf-cc"}
}

function saveFields(){
  if(!selPlat||!PF[selPlat])return;
  PF[selPlat].fields.forEach(f=>{
    if(f.type==="file")return;
    const el=document.getElementById(`pf_${f.k}`);
    if(el)curPlatData[f.k]=el.value;
  });
}

// â”€â”€â”€ FILE UPLOAD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function upFile(k,files){
  if(!token||!files.length)return;
  const fd=new FormData();
  for(const f of files)fd.append("files",f);
  try{
    const r=await fetch(API+"/upload",{method:"POST",headers:{"Authorization":"Bearer "+token},body:fd});
    const d=await r.json();if(!r.ok)throw new Error(d.error);
    if(!curPlatData._files[k])curPlatData._files[k]=[];
    curPlatData._files[k].push(...d.files);
    saveFields();showEditor();
  }catch(e){toast(e.message,false)}
}
function rmFile(k,i){curPlatData._files[k].splice(i,1);saveFields();showEditor()}

// â”€â”€â”€ SCHEDULE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleSched(){
  const mode=document.querySelector('input[name="schedMode"]:checked').value;
  document.querySelectorAll(".sopt").forEach(el=>el.classList.remove("on"));
  document.querySelector(`input[name="schedMode"][value="${mode}"]`).closest(".sopt").classList.add("on");
  document.getElementById("schedDateWrap").style.display=mode==="date"?"block":"none";
  document.getElementById("schedDelayWrap").style.display=mode==="delay"?"flex":"none";

  // ë‚ ì§œ ê¸°ë³¸ê°’: í˜„ì¬ ì‹œê°„ + 1ì‹œê°„
  if(mode==="date"&&!document.getElementById("schedDateTime").value){
    const d=new Date(Date.now()+3600000);
    document.getElementById("schedDateTime").value=d.toISOString().slice(0,16);
  }
  // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
  const btn=document.getElementById("pubBtn");
  btn.innerHTML=mode==="now"?"ğŸš€ "+t("pub"):"ğŸ“… "+t("pub");
}

function getScheduledFor(){
  const mode=document.querySelector('input[name="schedMode"]:checked').value;
  if(mode==="date"){
    const v=document.getElementById("schedDateTime").value;
    return v?new Date(v).toISOString():null;
  }else if(mode==="delay"){
    const h=parseInt(document.getElementById("schedDelayH").value)||1;
    return new Date(Date.now()+h*3600000).toISOString();
  }
  return null; // now
}

// â”€â”€â”€ PUBLISH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function doPublish(){
  if(!selPlat)return toast(t("selAt"),false);
  saveFields();

  const pf=PF[selPlat];
  const p=PL.find(x=>x.id===selPlat);
  const d=curPlatData;

  // í•„ìˆ˜ í•„ë“œ ê²€ì¦
  for(const f of pf.fields){
    if(!f.req)continue;
    if(f.type==="file"){
      if(!d._files?.[f.k]?.length)return toast(`${fl(f.k)} â€” ${fl("reqMark")}`,false);
    }else{
      if(!d[f.k]?.trim())return toast(`${fl(f.k)} â€” ${fl("reqMark")}`,false);
    }
  }

  // ë©”ì¸ í…ìŠ¤íŠ¸, ë¯¸ë””ì–´, í”Œë«í¼ ê³ ìœ  ë°ì´í„° ì¶”ì¶œ
  const mainKey=pf.fields.find(f=>["text","caption","description"].includes(f.k)&&f.type==="textarea")?.k;
  const content=d[mainKey]||d.title||"";

  const allFiles=[];
  Object.values(d._files||{}).forEach(arr=>allFiles.push(...arr));
  const mediaItems=allFiles.length?allFiles.map(f=>({type:f.type,url:f.url})):undefined;

  const spec={};
  if(d.title)spec.title=d.title;
  if(d.firstComment)spec.firstComment=d.firstComment;
  if(d.tags)spec.tags=d.tags.split(",").map(s=>s.trim()).filter(Boolean);
  if(d.subreddit)spec.subreddit=d.subreddit;
  if(d.link)spec.link=d.link;

  const btn=document.getElementById("pubBtn");
  const status=document.getElementById("transStatus");
  btn.disabled=true;

  const scheduledFor=getScheduledFor();
  const isScheduled=!!scheduledFor;

  async function postOne(c){
    const body={content:c,platforms:[selPlat],platformSpecific:{[selPlat]:spec}};
    if(mediaItems)body.mediaItems=mediaItems;
    if(scheduledFor)body.scheduledFor=scheduledFor;
    console.log("ğŸ“¤ Post request:", JSON.stringify(body));
    const url=editingPostId?"/posts/"+editingPostId:"/posts";
    const method=editingPostId?"PUT":"POST";
    const res=await api(url,{method,body:JSON.stringify(body)});
    console.log("ğŸ“¥ Post response:", JSON.stringify(res));
    return res;
  }

  try{
    const pubLabel=editingPostId?t("editDone"):isScheduled?t("schedOk"):t("pubd");
    if(selLangs.length<=1){
      btn.innerHTML=`<span class="spinner"></span> ${mediaItems?t("mediaUploading"):t("pubing")}`;
      await postOne(content);
      toast("âœ… "+pubLabel);
    }else{
      // ë‹¤êµ­ì–´ ë²ˆì—­ â†’ ì–¸ì–´ë³„ ê²Œì‹œ
      btn.innerHTML=`<span class="spinner"></span> ${t("translating")}`;
      status.style.display="block";status.innerHTML="";

      const fromLang=selLangs[0];
      const toLangs=selLangs.filter(l=>l!==fromLang);
      const contentMap={[fromLang]:content};

      if(toLangs.length>0){
        try{
          const tr=await api("/ai/translate",{method:"POST",body:JSON.stringify({content,fromLang,toLangs})});
          Object.assign(contentMap,tr.translations||{});
          status.innerHTML=`<span style="color:var(--ok)">âœ… ${t("transOk")}</span>`;
        }catch(e){
          status.innerHTML=`<span style="color:var(--warn)">âš ï¸ ${e.message.includes("DEEPL_API_KEY")?t("noApiKey"):t("transFail")}</span>`;
          toLangs.forEach(l=>{contentMap[l]=content});
        }
      }

      btn.innerHTML=`<span class="spinner"></span> ${mediaItems?t("mediaUploading"):t("pubing")}`;
      let ok=0;
      const langN={};LANGS.forEach(l=>{langN[l.id]=l.label.split(" ")[0]});
      for(const [tl,tc] of Object.entries(contentMap)){
        try{
          await postOne(tc);ok++;
          status.innerHTML+=`<div style="margin-top:4px">${langN[tl]||tl} âœ…</div>`;
        }catch(e){
          status.innerHTML+=`<div style="margin-top:4px;color:var(--err)">${langN[tl]||tl} âŒ ${e.message}</div>`;
        }
      }
      if(ok>0)toast("âœ… "+(isScheduled?t("schedOk"):t("pubMulti").replace("{n}",ok)));
      else toast("âŒ "+t("fail"),false);
    }

    // ì´ˆê¸°í™”
    editingPostId=null;
    selPlat="";curPlatData={_files:{}};
    buildPlats();
    // ì˜ˆì•½ ëª¨ë“œ ë¦¬ì…‹
    const nowRadio=document.querySelector('input[name="schedMode"][value="now"]');
    if(nowRadio){nowRadio.checked=true;toggleSched()}
    setTimeout(()=>{status.style.display="none"},5000);
  }catch(e){console.error("âŒ Publish error:",e);toast("âŒ "+e.message,false)}
  finally{btn.disabled=false;btn.innerHTML="ğŸš€ "+t("pub")}
}

// â”€â”€â”€ OAUTH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const OAUTH_ICONS={
  google:`<svg viewBox="0 0 24 24" width="18" height="18"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 01-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>`,
  microsoft:`<svg viewBox="0 0 21 21" width="18" height="18"><rect x="1" y="1" width="9" height="9" fill="#F25022"/><rect x="11" y="1" width="9" height="9" fill="#7FBA00"/><rect x="1" y="11" width="9" height="9" fill="#00A4EF"/><rect x="11" y="11" width="9" height="9" fill="#FFB900"/></svg>`,
  apple:`<svg viewBox="0 0 24 24" width="18" height="18" fill="white"><path d="M17.05 20.28c-.98.95-2.05.88-3.08.4-1.09-.5-2.08-.48-3.24 0-1.44.62-2.2.44-3.06-.4C2.79 15.25 3.51 7.59 9.05 7.31c1.35.07 2.29.74 3.08.8 1.18-.24 2.31-.93 3.57-.84 1.51.12 2.65.72 3.4 1.8-3.12 1.87-2.38 5.98.48 7.13-.57 1.5-1.31 2.99-2.54 4.09zM12.03 7.25c-.15-2.23 1.66-4.07 3.74-4.25.29 2.58-2.34 4.5-3.74 4.25z"/></svg>`,
};

let oauthProviders=[];

async function loadOAuthProviders(){
  try{
    const d=await fetch(API+"/auth/providers").then(r=>r.json());
    oauthProviders=d.providers||[];
  }catch(e){oauthProviders=[]}
  buildOAuthBtns();
}

function buildOAuthBtns(){
  const box=document.getElementById("oauthBtns");
  const div=document.getElementById("odiv");
  if(!oauthProviders.length){box.innerHTML="";div.style.display="none";return}
  div.style.display="flex";
  const labels={google:t("gLogin"),microsoft:t("mLogin"),apple:t("aLogin")};
  const cls={google:"g",microsoft:"m",apple:"a"};
  box.innerHTML=oauthProviders.map(p=>
    `<button class="obtn ${cls[p.id]||""}" onclick="location.href='${API}/auth/${p.id}'">${OAUTH_ICONS[p.id]||""} ${labels[p.id]||p.name}</button>`
  ).join("");
}

// â”€â”€â”€ OAuth ì½œë°± ì²˜ë¦¬ (URLì—ì„œ token ì¶”ì¶œ) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function handleOAuthCallback(){
  const params=new URLSearchParams(window.location.search);
  const t=params.get("token");
  const u=params.get("user");
  const err=params.get("error");

  if(err){
    showErr(err.replace(/_/g," "));
    window.history.replaceState({},"","/");
    return false;
  }
  if(t&&u){
    try{
      token=t;user=JSON.parse(decodeURIComponent(u));
      if(user.language)lang=user.language;
      localStorage.setItem("sh_t",token);
      localStorage.setItem("sh_u",JSON.stringify(user));
      localStorage.setItem("sh_l",lang);
      window.history.replaceState({},"","/");
      return true;
    }catch(e){}
  }
  return false;
}

// â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const oauthLogin=handleOAuthCallback();
loadSession();
if(oauthLogin){token=localStorage.getItem("sh_t");user=JSON.parse(localStorage.getItem("sh_u"));}
buildAuthLang();
updAuthTexts();
updTexts();
loadOAuthProviders();
if(token&&user)enterApp();
</script>
</body>
</html>
